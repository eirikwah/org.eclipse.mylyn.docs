<?xml version="1.0" encoding="UTF-8"?>
<project name="Test markup-to-epub" basedir="." default="test.item">
	<echoproperties>
	</echoproperties>
	<property name="testdir" location="${basedir}/test" />
	<property name="srcdir" location="${basedir}/test/src" />
	<property name="datadir" location="${basedir}/testdata" />

	<path id="java.class.path">
		<pathelement path="${java.class.path}" />
	</path>

	<taskdef classpathref="java.class.path" resource="org/eclipse/mylyn/wikitext/core/util/anttask/tasks.properties" />
	<taskdef classpathref="java.class.path" resource="org/eclipse/mylyn/internal/wikitext/mediawiki/core/tasks/tasks.properties" />

	<path id="epub-classpath">
		<pathelement location="${basedir}/../org.eclipse.mylyn.docs.epub/bin/" />
	</path>

	<taskdef classpathref="epub-classpath" resource="org/eclipse/mylyn/docs/epub/ant/tasks.properties" />

	<!-- Prepare source files that we need for the tests -->
	<target name="init">
		<delete dir="${testdir}" failonerror="false">
			<fileset dir="${testdir}">
				<include name="**/*" />
			</fileset>
		</delete>
		<mkdir dir="${testdir}" />
		<wikitext-to-html xhtmlstrict="true" internalLinkPattern="{0}"
			markupLanguage="org.eclipse.mylyn.wikitext.mediawiki.core.MediaWikiLanguage">
			<fileset dir="${datadir}">
				<include name="*.mediawiki" />
			</fileset>
			<stylesheet url="style.css" />
		</wikitext-to-html>
		<move todir="${srcdir}">
			<fileset dir="${datadir}">
				<include name="*.html" />
				<exclude name="Cover.html" />
			</fileset>
		</move>
		<mediawiki-fetch-images dest="${srcdir}" url="http://wiki.eclipse.org/" pageName="Development_Resources/New_Commmitter_Handbook" />
	</target>

	<target name="test.item">
		<html-to-epub identifierId="url" file="${testdir}/test.epub" workingFolder="${testdir}/work">
			<title text="Mylyn User Guide" />
			<language code="en" />
			<identifier id="url" scheme="URL" value="http://wiki.eclipse.org/Development_Resources/New_Commmitter_Handbook" />
			<subject text="Computing, Eclipse, Mylyn" />
			<creator name="Eclipse Committers and Contributors" role="aut" />
			<contributor name="Eclipse Committers and Contributors" role="aut" />
			<publisher text="Eclipse.Org" />
			<item file="${srcdir}/New_Committer_Handbook.html" />
			<item file="${srcdir}/Eclipse_Quality.html" />
			<item file="${datadir}/style.css" type="text/css" spine="false" />
			<toc generate="true" />
			<fileset dir="${srcdir}">
				<include name="*.gif" />
				<include name="*.png" />
			</fileset>
		</html-to-epub>
	</target>

</project>